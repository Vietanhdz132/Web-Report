<div class="report-pvt-create">
  <h1 class="report-pvt-create__title">Táº¡o BÃ¡o CÃ¡o Tuáº§n Má»›i - PhÃ²ng VÃ´ Tuyáº¿n</h1>

  <form id="createReportForm" action="/report/create" method="POST" class="report-pvt-create__form">
    <!-- ThÃ´ng tin chung -->
    <div class="report-pvt-create__group">
      <label for="week">Tuáº§n</label>
      <input id="week" name="week" type="number" required />
    </div>

    <div class="report-pvt-create__group">
      <label for="number">Sá»‘ hiá»‡u</label>
      <input id="number" name="number" type="text" required />
    </div>

    <div class="report-pvt-create__group">
      <label for="createdAt">NgÃ y táº¡o</label>
      <input id="createdAt" name="createdAt" type="date" required />
    </div>

    <!-- I. ÄÃ¡nh giÃ¡ káº¿t quáº£ triá»ƒn khai -->
    <hr />
    <h2>I. ÄÃNH GIÃ Káº¾T QUáº¢ TRIá»‚N KHAI</h2>

    <div class="report-pvt-create__group">
      <h4 for="bscKpi">1. Káº¿t quáº£ thá»±c hiá»‡n BSC-KPI</h4>
      <div class="report-section__children">
        <!-- NÆ¡i thÃªm má»¥c con Ä‘á»™ng -->
      </div>
      <div class="report-section__tools">
  <button type="button" class="btn-add-subitem" onclick="addChild(this)">â• ThÃªm má»¥c con</button>
  <button type="button" class="btn-add-table" onclick="addTable(this)">ğŸ“Š ThÃªm báº£ng</button>
</div>

    </div>

    <h4>2. CÃ´ng viá»‡c trá»ng tÃ¢m</h4>
    <!-- CÃ¡c má»¥c cÃ´ng tÃ¡c -->
    <div class="report-pvt-create__group">
      <label for="tuh">CÃ´ng tÃ¡c TUH</label>
      <div class="report-section__children"></div>
      <div class="report-section__tools">
  <button type="button" class="btn-add-subitem" onclick="addChild(this)">â• ThÃªm má»¥c con</button>
  <button type="button" class="btn-add-table" onclick="addTable(this)">ğŸ“Š ThÃªm báº£ng</button>
</div>

    </div>
    <div class="report-pvt-create__group">
      <label for="ptm">CÃ´ng tÃ¡c PTM</label>
      <div class="report-section__children"></div>
      <div class="report-section__tools">
  <button type="button" class="btn-add-subitem" onclick="addChild(this)">â• ThÃªm má»¥c con</button>
  <button type="button" class="btn-add-table" onclick="addTable(this)">ğŸ“Š ThÃªm báº£ng</button>
</div>

    </div>
    <div class="report-pvt-create__group">
      <label for="cntt">CÃ´ng tÃ¡c CNTT</label>
      <div class="report-section__children"></div>
      <div class="report-section__tools">
  <button type="button" class="btn-add-subitem" onclick="addChild(this)">â• ThÃªm má»¥c con</button>
  <button type="button" class="btn-add-table" onclick="addTable(this)">ğŸ“Š ThÃªm báº£ng</button>
</div>

    </div>
    <div class="report-pvt-create__group">
      <label for="vhm">CÃ´ng tÃ¡c VHM</label>
      <div class="report-section__children"></div>
      <div class="report-section__tools">
  <button type="button" class="btn-add-subitem" onclick="addChild(this)">â• ThÃªm má»¥c con</button>
  <button type="button" class="btn-add-table" onclick="addTable(this)">ğŸ“Š ThÃªm báº£ng</button>
</div>

    </div>
    <div class="report-pvt-create__group">
      <label for="khcp">CÃ´ng tÃ¡c KHCP</label>
      <div class="report-section__children"></div>
      <div class="report-section__tools">
  <button type="button" class="btn-add-subitem" onclick="addChild(this)">â• ThÃªm má»¥c con</button>
  <button type="button" class="btn-add-table" onclick="addTable(this)">ğŸ“Š ThÃªm báº£ng</button>
</div>

    </div>

    <!-- II. Káº¿t luáº­n chá»‰ Ä‘áº¡o -->
    <hr />
    <h2>II. THá»°C HIá»†N Káº¾T LUáº¬N, CHá»ˆ Äáº O</h2>
    <div class="report-pvt-create__group">
      <h4 for="conclusion">Ná»™i dung káº¿t luáº­n, chá»‰ Ä‘áº¡o</h4>
      <div class="report-section__children"></div>
      <div class="report-section__tools">
  <button type="button" class="btn-add-subitem" onclick="addChild(this)">â• ThÃªm má»¥c con</button>
  <button type="button" class="btn-add-table" onclick="addTable(this)">ğŸ“Š ThÃªm báº£ng</button>
</div>

    </div>

    <!-- III. Tá»“n táº¡i, kiáº¿n nghá»‹ -->
    <hr />
    <h2>III. Tá»’N Táº I, KIáº¾N NGHá»Š</h2>
    <div class="report-pvt-create__group">
      <h4 for="kientnghi_ldtt">1. Kiáº¿n nghá»‹ vá»›i LÄTT/TCT</h4>
      <div class="report-section__children"></div>
      <div class="report-section__tools">
  <button type="button" class="btn-add-subitem" onclick="addChild(this)">â• ThÃªm má»¥c con</button>
  <button type="button" class="btn-add-table" onclick="addTable(this)">ğŸ“Š ThÃªm báº£ng</button>
</div>

    </div>
    <div class="report-pvt-create__group">
      <h4 for="kientnghi_dvkhac">2. Kiáº¿n nghá»‹ vá»›i Ä‘Æ¡n vá»‹ khÃ¡c</h4>
      <div class="report-section__children"></div>
      <div class="report-section__tools">
  <button type="button" class="btn-add-subitem" onclick="addChild(this)">â• ThÃªm má»¥c con</button>
  <button type="button" class="btn-add-table" onclick="addTable(this)">ğŸ“Š ThÃªm báº£ng</button>
</div>

    </div>

    <!-- IV. Káº¿ hoáº¡ch tuáº§n tá»›i -->
    <hr />
    <h2>IV. Káº¾ HOáº CH TUáº¦N Tá»šI</h2>
    <div class="report-pvt-create__group">
      <label for="kehoach_tuh">CÃ´ng tÃ¡c TUH</label>
      <div class="report-section__children"></div>
      <div class="report-section__tools">
  <button type="button" class="btn-add-subitem" onclick="addChild(this)">â• ThÃªm má»¥c con</button>
  <button type="button" class="btn-add-table" onclick="addTable(this)">ğŸ“Š ThÃªm báº£ng</button>
</div>

    </div>
    <div class="report-pvt-create__group">
      <label for="kehoach_ptm">CÃ´ng tÃ¡c PTM</label>
      <div class="report-section__children"></div>
      <div class="report-section__tools">
  <button type="button" class="btn-add-subitem" onclick="addChild(this)">â• ThÃªm má»¥c con</button>
  <button type="button" class="btn-add-table" onclick="addTable(this)">ğŸ“Š ThÃªm báº£ng</button>
</div>

    </div>
    <div class="report-pvt-create__group">
      <label for="kehoach_cntt">CÃ´ng tÃ¡c CNTT</label>
      <div class="report-section__children"></div>
      <div class="report-section__tools">
  <button type="button" class="btn-add-subitem" onclick="addChild(this)">â• ThÃªm má»¥c con</button>
  <button type="button" class="btn-add-table" onclick="addTable(this)">ğŸ“Š ThÃªm báº£ng</button>
</div>

    </div>
    <div class="report-pvt-create__group">
      <label for="kehoach_vhm">CÃ´ng tÃ¡c VHM</label>
      <div class="report-section__children"></div>
      <div class="report-section__tools">
  <button type="button" class="btn-add-subitem" onclick="addChild(this)">â• ThÃªm má»¥c con</button>
  <button type="button" class="btn-add-table" onclick="addTable(this)">ğŸ“Š ThÃªm báº£ng</button>
</div>

    </div>
    <div class="report-pvt-create__group">
      <label for="kehoach_khcp">CÃ´ng tÃ¡c KHCP</label>
      <div class="report-section__children"></div>
      <div class="report-section__tools">
  <button type="button" class="btn-add-subitem" onclick="addChild(this)">â• ThÃªm má»¥c con</button>
  <button type="button" class="btn-add-table" onclick="addTable(this)">ğŸ“Š ThÃªm báº£ng</button>
</div>

    </div>

    <!-- NÆ¡i nháº­n -->
    <hr />
    <h2>NÆ I NHáº¬N</h2>
    <div class="report-pvt-create__group">
      <label for="receivers">NÆ¡i nháº­n</label>
      <textarea id="receivers" name="receivers" rows="4" required>
- NhÆ° trÃªn;
- Ban GÄTT;
- Tá»•ng há»£p, TCHC;
- LÆ°u VTN.
      </textarea>
    </div>

    <!-- KÃ½ tÃªn -->
    <hr />
    <h2>ThÃ´ng tin kÃ½ bÃ¡o cÃ¡o</h2>
    <div class="report-pvt-create__group">
      <label for="signer">NgÆ°á»i kÃ½</label>
      <input id="signer" name="signer" type="text" value="Äá»— Duy BÃ¬nh" required />
    </div>
    <div class="report-pvt-create__group">
      <label for="position">Chá»©c vá»¥</label>
      <input id="position" name="position" type="text" value="TRÆ¯á»NG PHÃ’NG" required />
    </div>

    <div class="report-pvt-create__actions">
      <button type="submit">ğŸ’¾ LÆ°u bÃ¡o cÃ¡o</button>
      <a href="/report" class="btn-cancel">Há»§y</a>
    </div>
  </form>
</div>


<script>
  document.querySelectorAll('textarea').forEach(textarea => {
  function autoResize() {
    this.style.height = 'auto';
    this.style.height = this.scrollHeight + 'px';
  }
  textarea.addEventListener('input', autoResize);
  autoResize.call(textarea);
});

</script>

<script>
  // Tá»± Ä‘á»™ng resize textarea
  function autoResizeTextarea(el) {
    el.style.height = 'auto';
    el.style.height = el.scrollHeight + 'px';
  }

  // ThÃªm má»¥c con (title + ná»™i dung)
  function addChild(button) {
    const container = button.closest('.report-pvt-create__group').querySelector('.report-section__children');

    const childWrapper = document.createElement('div');
    childWrapper.className = 'report-subitem';

    // Thay input tiÃªu Ä‘á» thÃ nh textarea Ä‘á»ƒ há»— trá»£ xuá»‘ng dÃ²ng
    const titleTextarea = document.createElement('textarea');
    titleTextarea.name = 'childTitles[]';
    titleTextarea.placeholder = 'TiÃªu Ä‘á» má»¥c con';
    titleTextarea.className = 'child-title';
    titleTextarea.rows = 1;
    titleTextarea.addEventListener('input', () => autoResizeTextarea(titleTextarea));

    const contentTextarea = document.createElement('textarea');
    contentTextarea.name = 'childContents[]';
    contentTextarea.rows = 3;
    contentTextarea.placeholder = 'Ná»™i dung má»¥c con';
    contentTextarea.addEventListener('input', () => autoResizeTextarea(contentTextarea));

    const removeBtn = document.createElement('button');
    removeBtn.type = 'button';
    removeBtn.textContent = 'âŒ XoÃ¡';
    removeBtn.onclick = () => childWrapper.remove();

    childWrapper.appendChild(titleTextarea);
    childWrapper.appendChild(contentTextarea);
    childWrapper.appendChild(removeBtn);

    container.appendChild(childWrapper);

    // Tá»± Ä‘á»™ng resize ngay sau khi thÃªm
    autoResizeTextarea(titleTextarea);
    autoResizeTextarea(contentTextarea);
  }


  function addTable(button) {
  const container = button.closest('.report-pvt-create__group').querySelector('.report-section__children');

  const tableWrapper = document.createElement('div');
  tableWrapper.className = 'report-subtable';

  // HÃ m tá»± Ä‘á»™ng resize textarea
  function autoResizeTextarea(textarea) {
    textarea.style.height = 'auto';
    textarea.style.height = textarea.scrollHeight + 'px';
  }

  // TiÃªu Ä‘á» báº£ng lÃ  textarea
  const titleTextarea = document.createElement('textarea');
  titleTextarea.name = 'tableTitles[]';
  titleTextarea.placeholder = 'TiÃªu Ä‘á» báº£ng';
  titleTextarea.className = 'table-title';
  titleTextarea.rows = 1;
  titleTextarea.style.width = '100%';
  titleTextarea.style.boxSizing = 'border-box';
  titleTextarea.style.resize = 'vertical';
  titleTextarea.style.marginBottom = '12px';
  titleTextarea.addEventListener('input', () => autoResizeTextarea(titleTextarea));
  autoResizeTextarea(titleTextarea);

  // Pháº§n chá»n sá»‘ hÃ ng vÃ  cá»™t
  const configDiv = document.createElement('div');
  configDiv.style.marginBottom = '14px';
  configDiv.style.display = 'flex';
  configDiv.style.alignItems = 'center';
  configDiv.style.gap = '12px';

  const rowsLabel = document.createElement('label');
  rowsLabel.textContent = 'Sá»‘ hÃ ng: ';
  const rowsInput = document.createElement('input');
  rowsInput.type = 'number';
  rowsInput.min = 1;
  rowsInput.value = 3;
  rowsInput.style.width = '60px';
  rowsInput.style.padding = '6px 8px';
  rowsLabel.appendChild(rowsInput);

  const colsLabel = document.createElement('label');
  colsLabel.textContent = ' Sá»‘ cá»™t: ';
  const colsInput = document.createElement('input');
  colsInput.type = 'number';
  colsInput.min = 1;
  colsInput.value = 3;
  colsInput.style.width = '60px';
  colsInput.style.padding = '6px 8px';
  colsLabel.appendChild(colsInput);

  const createBtn = document.createElement('button');
  createBtn.type = 'button';
  createBtn.textContent = 'Táº¡o báº£ng';
  createBtn.style.padding = '8px 16px';
  createBtn.style.backgroundColor = '#0078d7';
  createBtn.style.color = '#fff';
  createBtn.style.border = 'none';
  createBtn.style.borderRadius = '6px';
  createBtn.style.cursor = 'pointer';
  createBtn.style.fontWeight = '600';
  createBtn.style.transition = 'background-color 0.3s ease';
  createBtn.onmouseenter = () => (createBtn.style.backgroundColor = '#005ea8');
  createBtn.onmouseleave = () => (createBtn.style.backgroundColor = '#0078d7');

  createBtn.onclick = () => {
    const rows = parseInt(rowsInput.value);
    const cols = parseInt(colsInput.value);
    if (rows > 0 && cols > 0) {
      createTable(rows, cols);
    } else {
      alert('Sá»‘ hÃ ng vÃ  sá»‘ cá»™t pháº£i lá»›n hÆ¡n 0');
    }
  };

  configDiv.appendChild(rowsLabel);
  configDiv.appendChild(colsLabel);
  configDiv.appendChild(createBtn);

  const table = document.createElement('table');
  table.className = 'editable-table';
  table.style.width = '100%';
  table.style.borderCollapse = 'collapse';

  function createTable(rows, cols) {
    table.innerHTML = '';
    for (let i = 0; i < rows; i++) {
      const tr = document.createElement('tr');
      for (let j = 0; j < cols; j++) {
        const td = document.createElement('td');
        td.style.border = '1px solid #ccc';
        td.style.padding = '6px 10px';

        const textarea = document.createElement('textarea');
        textarea.name = `tableCell[]`;
        textarea.rows = 2;
        textarea.style.width = '100%';
        textarea.style.boxSizing = 'border-box';
        textarea.style.resize = 'vertical';
        textarea.style.fontFamily = 'inherit';

        // Gáº¯n event tá»± Ä‘á»™ng resize
        textarea.addEventListener('input', () => autoResizeTextarea(textarea));
        autoResizeTextarea(textarea);

        td.appendChild(textarea);
        tr.appendChild(td);
      }
      table.appendChild(tr);
    }
  }

  // Táº¡o báº£ng máº·c Ä‘á»‹nh 3x3
  createTable(3, 3);

  // NÃºt xoÃ¡ Ä‘áº·t dÆ°á»›i báº£ng
  const removeBtn = document.createElement('button');
  removeBtn.type = 'button';
  removeBtn.textContent = 'âŒ XÃ³a báº£ng';
  removeBtn.style.marginTop = '14px';
  removeBtn.style.backgroundColor = '#e04545';
  removeBtn.style.color = '#fff';
  removeBtn.style.border = 'none';
  removeBtn.style.borderRadius = '6px';
  removeBtn.style.padding = '8px 18px';
  removeBtn.style.fontWeight = '700';
  removeBtn.style.cursor = 'pointer';
  removeBtn.style.transition = 'background-color 0.3s ease';
  removeBtn.onmouseenter = () => (removeBtn.style.backgroundColor = '#a82727');
  removeBtn.onmouseleave = () => (removeBtn.style.backgroundColor = '#e04545');
  removeBtn.onclick = () => tableWrapper.remove();

  tableWrapper.appendChild(titleTextarea);
  tableWrapper.appendChild(configDiv);
  tableWrapper.appendChild(table);
  tableWrapper.appendChild(removeBtn);

  container.appendChild(tableWrapper);
}



</script>