<div class="report-pvt">
  <h1 class="report-pvt__title">📄 Báo cáo tuần - Phòng Vô Tuyến</h1>

  <!-- Nút Tạo mới -->
  <div class="report-pvt__create-wrapper">
    <a href="/report/pvt/create" class="report-pvt__button-create">➕ Tạo báo cáo mới</a>
  </div>

  <!-- Danh sách báo cáo -->
  <section class="report-pvt__list">
  <h2 class="report-pvt__list-title">📋 Danh sách báo cáo</h2>
<div class="report-pvt__table-wrapper">
  <table id="reportTable" class="report-pvt__table" style="display:none;">
    <thead>
      <tr>
        <th>Tên báo cáo</th>
        <th>Số hiệu</th>
        <th>Ngày tạo</th>
        <th>Phòng</th>
        <th>Hành động</th>
      </tr>
    </thead>
    <tbody id="reportTableBody"></tbody>
  </table>
</div>
  <p id="noReports" class="report-pvt__no-data" style="display:none;">Chưa có báo cáo nào.</p>
</section>

</div>

<script>
  document.addEventListener('DOMContentLoaded', async () => {
  const tbody = document.getElementById('reportTableBody');
  const noDataMsg = document.getElementById('noReports');
  const reportTable = document.getElementById('reportTable');

  if (!tbody || !noDataMsg || !reportTable) {
    console.error('❌ Thiếu phần tử trong DOM, kiểm tra lại HTML!');
    return;
  }

  try {
    const res = await fetch('/report/pvt');
    const { success, reports } = await res.json();

    if (!success || !reports.length) {
      noDataMsg.style.display = 'block';
      reportTable.style.display = 'none';
      return;
    }

    noDataMsg.style.display = 'none';
    reportTable.style.display = 'table';

    // Xóa hết các dòng cũ (nếu có)
    tbody.innerHTML = '';

    reports.forEach(report => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${report.reportName}</td>
        <td>${report.number}</td>
        <td>${report.date}</td>
        <td>${report.department || 'Phòng Vô Tuyến'}</td>
        <td class="report-pvt__actions">
          <a href="/report/view/${report._id}" class="report-pvt__action-link">📄 Xem</a>
          <a href="/report/edit/${report._id}" class="report-pvt__action-link">✏️ Sửa</a>
          <form action="/report/${report._id}" method="POST" class="report-pvt__action-form" style="display:inline;">
            <input type="hidden" name="_method" value="DELETE">
            <button type="submit" onclick="return confirm('Xoá báo cáo này?')" class="report-pvt__action-delete">🗑️ Xóa</button>
          </form>
        </td>
      `;
      tbody.appendChild(tr);
    });
  } catch (err) {
    console.error('❌ Error loading reports:', err);
    alert('Không thể tải danh sách báo cáo.');
  }
});

</script>
