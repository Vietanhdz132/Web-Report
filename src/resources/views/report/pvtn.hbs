<div class="report-pvt">
  <h1 class="report-pvt__title">ğŸ“„ BÃ¡o cÃ¡o tuáº§n - PhÃ²ng VÃ´ Tuyáº¿n</h1>

  <!-- NÃºt Táº¡o má»›i -->
  <div class="report-pvt__create-wrapper">
    <a href="/report/pvt/create" class="report-pvt__button-create">â• Táº¡o bÃ¡o cÃ¡o má»›i</a>
  </div>

  <!-- Danh sÃ¡ch bÃ¡o cÃ¡o -->
  <section class="report-pvt__list">
    <h2 class="report-pvt__list-title">ğŸ“‹ Danh sÃ¡ch bÃ¡o cÃ¡o</h2>
    <div class="report-pvt__table-wrapper">
      <table id="reportTable" class="report-pvt__table" style="display:none;">
        <thead>
          <tr>
            <th>TÃªn bÃ¡o cÃ¡o</th>
            <th>Sá»‘ hiá»‡u</th>
            <th>NgÃ y táº¡o</th>
            <th>PhÃ²ng</th>
            <th>HÃ nh Ä‘á»™ng</th>
          </tr>
        </thead>
        <tbody id="reportTableBody"></tbody>
      </table>
    </div>
    <p id="noReports" class="report-pvt__no-data" style="display:none;">ChÆ°a cÃ³ bÃ¡o cÃ¡o nÃ o.</p>
  </section>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    loadReports();
  });

  async function loadReports() {
    const tbody = document.getElementById('reportTableBody');
    const noDataMsg = document.getElementById('noReports');
    const reportTable = document.getElementById('reportTable');

    if (!tbody || !noDataMsg || !reportTable) {
      console.error('âŒ Thiáº¿u pháº§n tá»­ trong DOM, kiá»ƒm tra láº¡i HTML!');
      return;
    }

    try {
      const res = await fetch('/report/pvt');
      const { success, reports } = await res.json();

      if (!success || !reports.length) {
        noDataMsg.style.display = 'block';
        reportTable.style.display = 'none';
        tbody.innerHTML = '';
        return;
      }

      noDataMsg.style.display = 'none';
      reportTable.style.display = 'table';

      tbody.innerHTML = '';

      reports.forEach(report => {
        const tr = document.createElement('tr');
        tr.setAttribute('data-id', report._id);
        tr.innerHTML = `
          <td>${report.reportName}</td>
          <td>${report.number}</td>
          <td>${report.date}</td>
          <td>${report.department || 'PhÃ²ng VÃ´ Tuyáº¿n'}</td>
          <td class="report-pvt__actions">
            <a href="/report/pvt/detail/${report._id}" class="report-pvt__action-link">ğŸ“„ Xem</a>
            <a href="/report/edit/${report._id}" class="report-pvt__action-link">âœï¸ Sá»­a</a>
            <button class="report-pvt__action-delete" onclick="deleteReport('${report._id}')">ğŸ—‘ï¸ XÃ³a</button>
          </td>
        `;
        tbody.appendChild(tr);
      });
    } catch (err) {
      console.error('âŒ Error loading reports:', err);
      alert('KhÃ´ng thá»ƒ táº£i danh sÃ¡ch bÃ¡o cÃ¡o.');
    }
  }

  async function deleteReport(id) {
    if (!confirm('XoÃ¡ bÃ¡o cÃ¡o nÃ y?')) return;

    try {
      const res = await fetch(`/report/pvt/${id}`, {
        method: 'DELETE',
      });
      const data = await res.json();

      if (data.success) {
        showAlert(' XÃ³a bÃ¡o cÃ¡o thÃ nh cÃ´ng !', 'success');
        loadReports(); // Load láº¡i danh sÃ¡ch bÃ¡o cÃ¡o sau khi xÃ³a
      } else {
        showAlert('XÃ³a tháº¥t báº¡i: ' + (data.message || 'Lá»—i khÃ´ng xÃ¡c Ä‘á»‹nh'), 'danger');
      }
    } catch (err) {
      showAlert('Lá»—i khi xÃ³a bÃ¡o cÃ¡o: ' + err.message, 'danger');
    }
  }

</script>
